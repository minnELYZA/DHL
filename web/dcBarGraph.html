<!DOCTYPE html>
<html lang='en'>
    <head>
      <meta charset='utf-8'>

      <title>dc.js Experiment</title>

      <script src='js/d3.js' type='text/javascript'></script>
      <script src='js/crossfilter.js' type='text/javascript'></script>
      <script src='js/dc.js' type='text/javascript'></script>
    </head>

    <body>

    <div class='container' style='font: 12px sans-serif;'>
        <div class='row'>
            <div class='span6' id='dc-CDC-chart'>
                <h4>Events by Magnitude</h4>
            </div>
            <div class='span6' id='blank'>
                <h4>Blank</h4>
            </div>    
        </div>
      <div class='row'>
        <div class='span12'>
          <table class='table table-hover' id='dc-table-graph'>
            <thead>
              <tr class='header'>
                <th>AveDensity</th>
                <th>Deliveries</th>
                <th>AveCO2km</th>
                <th>TrafficRating</th>
                <th>DensityRating</th>
                <th>EfficiencyRating</th>
              </tr>
            </thead>
          </table>
        </div>
      </div>
    </div>

        <script>

        // load data from a csv file
        d3.csv("data/CDCSheet2.csv", function (data) {

          data.forEach(function(d) { 
            d.AveDensity = Math.round(+d.AveDensity);
            d.Deliveries = +d.Deliveries;
            d.AveCO2km = (+d.AveCO2km).toFixed(3);
            d.TrafficRating = +d.TrafficRating;
            d.DensityRating = +d.DensityRating;
            d.EfficiencyRating = +d.EfficiencyRating;
          });

          // Create the dc.js chart objects & link to div
          var dataTable = dc.dataTable("#dc-table-graph");
          var CDCChart = dc.barChart("dc-CDC-chart")
          // Run the data through crossfilter and load our 'facts'
          var facts = crossfilter(data);

          // Create dataTable dimension
          var magValue = facts.dimension(function (d) {
              return d.mag;
          });
          var magValueGroupCount = magValue.group()
                  .reduceCount(function (d) { return d.mag; })
          var timeDimension = facts.dimension(function (d) {
            return d.AveDensity;
          });

          // Setup the charts
          
          // Table of earthquake data
          dataTable.width(960).height(800)
            .dimension(timeDimension)
            .group(function(d) { return "CDC Table"
             })
            .size(10)
            .columns([
              function(d) { return d.AveDensity; },
              function(d) { return d.Deliveries; },
              function(d) { return d.AveCO2km; },
              function(d) { return d.TrafficRating; },
              function(d) { return d.DensityRating; },
              function(d) { return d.EfficiencyRating; }
            ])
            .sortBy(function(d){ return d.AveDensity; })
            .order(d3.ascending);

          // Render the Charts
          CDCChart.width(480)
            .height(150)
            .margins({top: 10, right: 10, bottom: 20, left: 40})
            .dimension(magValue)
            .group(magValueGroupCount)
            .transitionDuration(500)
            .centerBar(true)    
            .gap(65)
            .filter([3, 5])
            .x(d3.scale.linear().domain([0, data.length+1]))
            .elasticY(true)
            .xAxis().tickFormat(); 
        
          dc.renderAll();
          
          
        }); 
        
        </script>
    </body>
</html>
